<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©stionLoc Pro - 100% Local</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .dark { background-color: #1a202c; color: #e2e8f0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-300">

    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex justify-around p-2 z-50">
        <button onclick="showTab('locataires')" class="flex flex-col items-center text-blue-600">
            <span class="text-xs">Locataires</span>
        </button>
        <button onclick="showTab('quittances')" class="flex flex-col items-center text-gray-500">
            <span class="text-xs">Quittances</span>
        </button>
        <button onclick="showTab('compta')" class="flex flex-col items-center text-gray-500">
            <span class="text-xs">Compta</span>
        </button>
        <button onclick="showTab('config')" class="flex flex-col items-center text-gray-500">
            <span class="text-xs">Param√®tres</span>
        </button>
    </nav>

    <div class="max-w-md mx-auto p-4 pb-24">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-bold dark:text-white">G√©stionLoc üè†</h1>
            <div id="themeIndicator" class="text-xs font-mono opacity-50">MODE LOCAL</div>
        </header>

        <section id="locataires" class="tab-content active">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Mes Locataires</h2>
                <button onclick="openModal('modalLocataire')" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm">+ Ajouter</button>
            </div>

            <input type="text" id="searchLoc" onkeyup="filterLocataires()" placeholder="Rechercher un locataire..." 
                class="w-full p-2 mb-4 rounded-lg border border-gray-300 dark:bg-gray-700 dark:border-gray-600 outline-none">

            <div id="listeLocataires" class="space-y-3"></div>
        </section>

        <section id="quittances" class="tab-content">
            <h2 class="text-lg font-semibold mb-4">G√©n√©rer Quittance</h2>
            <form id="formQuittance" class="space-y-3 bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                <select id="qLocataire" class="w-full p-2 rounded border dark:bg-gray-700"></select>
                <input type="number" id="qMontant" placeholder="Montant" class="w-full p-2 rounded border dark:bg-gray-700">
                <div class="grid grid-cols-2 gap-2">
                    <input type="date" id="qDebut" class="p-2 rounded border dark:bg-gray-700">
                    <input type="date" id="qFin" class="p-2 rounded border dark:bg-gray-700">
                </div>
                <button type="button" onclick="genererPDFQuittance()" class="w-full bg-green-600 text-white p-2 rounded-lg font-bold">T√©l√©charger PDF</button>
            </form>
        </section>

        <section id="compta" class="tab-content text-center">
            <h2 class="text-lg font-semibold mb-4 text-left">Comptabilit√© Mensuelle</h2>
            <div class="bg-blue-600 text-white p-6 rounded-3xl shadow-lg">
                <p class="text-sm opacity-80">Revenu Total Estim√©</p>
                <h3 id="totalCompta" class="text-3xl font-bold">0 FCFA</h3>
            </div>
            <div id="comptaDetail" class="mt-6 text-left space-y-2"></div>
        </section>

        <section id="config" class="tab-content">
            <h2 class="text-lg font-semibold mb-4">Param√®tres du Propri√©taire</h2>
            <div class="space-y-4">
                <input type="text" id="proprioPrenom" placeholder="Pr√©nom" class="w-full p-2 border rounded dark:bg-gray-700">
                <input type="text" id="proprioNom" placeholder="Nom" class="w-full p-2 border rounded dark:bg-gray-700">
                <input type="text" id="proprioAdresse" placeholder="Adresse compl√®te" class="w-full p-2 border rounded dark:bg-gray-700">
                <button onclick="saveProprio()" class="w-full bg-gray-800 text-white p-2 rounded">Sauvegarder Profil</button>
                
                <hr class="my-4 border-gray-300">
                
                <div class="flex justify-between items-center">
                    <span>Mode Sombre</span>
                    <input type="checkbox" id="themeSwitch" onchange="toggleDarkMode()" class="w-10 h-5">
                </div>
            </div>
        </section>
    </div>

    <div id="modalLocataire" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100]">
        <div class="bg-white dark:bg-gray-800 w-full max-w-sm p-6 rounded-2xl">
            <h3 class="text-lg font-bold mb-4">Nouveau Locataire</h3>
            <div class="space-y-3">
                <input type="text" id="lPrenom" placeholder="Pr√©nom" class="w-full p-2 border rounded dark:bg-gray-700">
                <input type="text" id="lNom" placeholder="Nom" class="w-full p-2 border rounded dark:bg-gray-700">
                <input type="text" id="lLocal" placeholder="Local (ex: Appt A1)" class="w-full p-2 border rounded dark:bg-gray-700">
                <input type="number" id="lLoyer" placeholder="Montant Loyer" class="w-full p-2 border rounded dark:bg-gray-700">
                <input type="text" id="lNCI" placeholder="NCI / Passeport" class="w-full p-2 border rounded dark:bg-gray-700">
                <div class="flex gap-2">
                    <button onclick="closeModal('modalLocataire')" class="flex-1 p-2 bg-gray-200 dark:bg-gray-600 rounded">Annuler</button>
                    <button onclick="saveLocataire()" class="flex-1 p-2 bg-blue-600 text-white rounded">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('locData')) || { proprio: {}, locataires: [] };

        function saveDB() {
            localStorage.setItem('locData', JSON.stringify(db));
            renderLocataires();
            updateSelects();
            calculCompta();
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('nav button').forEach(btn => btn.classList.replace('text-blue-600', 'text-gray-500'));
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            localStorage.setItem('darkMode', document.body.classList.contains('dark'));
        }

        function saveLocataire() {
            const loc = {
                id: Date.now(),
                prenom: document.getElementById('lPrenom').value,
                nom: document.getElementById('lNom').value,
                local: document.getElementById('lLocal').value,
                loyer: parseFloat(document.getElementById('lLoyer').value),
                nci: document.getElementById('lNCI').value,
                actif: true
            };
            db.locataires.push(loc);
            saveDB();
            closeModal('modalLocataire');
        }

        function resilierBail(id) {
            if(confirm("R√©silier le bail de ce locataire ?")) {
                db.locataires = db.locataires.filter(l => l.id !== id);
                saveDB();
            }
        }

        function renderLocataires(filter = "") {
            const list = document.getElementById('listeLocataires');
            list.innerHTML = "";
            db.locataires
                .filter(l => (l.prenom + " " + l.nom).toLowerCase().includes(filter.toLowerCase()))
                .forEach(l => {
                    const card = document.createElement('div');
                    card.className = "bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm flex justify-between items-center border border-gray-100 dark:border-gray-700";
                    
                    const info = document.createElement('div');
                    const name = document.createElement('p');
                    name.className = "font-bold";
                    name.textContent = `${l.prenom} ${l.nom}`;
                    const details = document.createElement('p');
                    details.className = "text-xs text-gray-500";
                    details.textContent = `${l.local} - ${l.loyer} FCFA`;
                    info.appendChild(name);
                    info.appendChild(details);

                    const actions = document.createElement('div');
                    actions.className = "flex gap-2";
                    
                    const bailBtn = document.createElement('button');
                    bailBtn.className = "text-xs text-blue-500 uppercase font-bold";
                    bailBtn.textContent = "Bail";
                    bailBtn.onclick = () => genererBailPDF(l.id);
                    
                    const delBtn = document.createElement('button');
                    delBtn.className = "text-xs text-red-500 uppercase font-bold";
                    delBtn.textContent = "R√©silier";
                    delBtn.onclick = () => resilierBail(l.id);
                    
                    actions.appendChild(bailBtn);
                    actions.appendChild(delBtn);
                    
                    card.appendChild(info);
                    card.appendChild(actions);
                    list.appendChild(card);
                });
        }

        function filterLocataires() {
            renderLocataires(document.getElementById('searchLoc').value);
        }

        function genererBailPDF(id) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const l = db.locataires.find(x => x.id === id);
            const p = db.proprio;

            doc.setFontSize(18);
            doc.text("CONTRAT DE BAIL √Ä USAGE D'HABITATION", 20, 30);
            doc.setFontSize(12);
            doc.text(`ENTRE LE PROPRIETAIRE: ${p.prenom || ''} ${p.nom || ''}, r√©sidant √† ${p.adresse || ''}`, 20, 50);
            doc.text(`ET LE LOCATAIRE: ${l.prenom} ${l.nom}, NCI: ${l.nci}`, 20, 60);
            doc.text(`LOCAL OCCUP√â: ${l.local}`, 20, 70);
            doc.text(`LOYER MENSUEL: ${l.loyer} FCFA`, 20, 80);
            doc.text(`Fait le: ${new Date().toLocaleDateString()}`, 20, 100);
            
            doc.save(`Contrat_${l.nom}.pdf`);
        }

        function genererPDFQuittance() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const locId = document.getElementById('qLocataire').value;
            const l = db.locataires.find(x => x.id == locId);
            const p = db.proprio;

            doc.rect(10, 10, 190, 80);
            doc.setFontSize(16);
            doc.text("QUITTANCE DE LOYER", 70, 25);
            doc.setFontSize(10);
            doc.text(`Propri√©taire: ${p.prenom} ${p.nom}`, 20, 40);
            doc.text(`Locataire: ${l.prenom} ${l.nom}`, 20, 50);
            doc.text(`P√©riode: Du ${document.getElementById('qDebut').value} au ${document.getElementById('qFin').value}`, 20, 60);
            doc.text(`MONTANT: ${document.getElementById('qMontant').value} FCFA`, 20, 70);
            
            doc.save(`Quittance_${l.nom}.pdf`);
        }

        function saveProprio() {
            db.proprio = {
                prenom: document.getElementById('proprioPrenom').value,
                nom: document.getElementById('proprioNom').value,
                adresse: document.getElementById('proprioAdresse').value
            };
            saveDB();
            alert("Profil mis √† jour !");
        }

        function updateSelects() {
            const select = document.getElementById('qLocataire');
            select.innerHTML = "";
            db.locataires.forEach(l => {
                const opt = document.createElement('option');
                opt.value = l.id;
                opt.textContent = `${l.prenom} ${l.nom}`;
                select.appendChild(opt);
            });
        }

        function calculCompta() {
            const total = db.locataires.reduce((sum, l) => sum + l.loyer, 0);
            document.getElementById('totalCompta').innerText = total.toLocaleString() + " FCFA";
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        if(localStorage.getItem('darkMode') === 'true') toggleDarkMode();
        document.getElementById('proprioPrenom').value = db.proprio.prenom || "";
        document.getElementById('proprioNom').value = db.proprio.nom || "";
        document.getElementById('proprioAdresse').value = db.proprio.adresse || "";
        saveDB();
    </script>
</body>
</html>